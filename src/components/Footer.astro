---
const today = new Date()

const isShowingBanner = false
const isShowingFooter = true
const isShowingPanel = true

// const pathname = Astro.url.pathname
// console.log('REQUEST', Astro.request)
// console.log('PATHNAME', pathname)
---

<section id="frame-panel" class="h-[100px] flex justify-between items-center gap-3 bg-gradient-to-b from-stone-500 to-stone-900 border-t border-amber-900 overflow-hidden">
	<div class="h-[40px] flex items-center">
		<input
			id="txt-target-url"
			type="text"
			class="w-1/2 h-full px-3 py-2 bg-amber-700 text-2xl font-bold text-amber-300 tracking-wider outline-none"
		/>

		<button id="btn-load-target" class="w-fit h-full flex items-center px-5 py-2 bg-amber-400 hover:bg-amber-300 text-2xl font-bold text-amber-800">
			GO!
		</button>

		<button id="btn-download" class="w-fit h-full flex items-center px-5 py-2 bg-amber-400 hover:bg-amber-300 text-2xl font-bold text-amber-800">
			Download
			<span class="hidden sm:inline"> .ZIP</span>
		</button>
	</div>
</section>

{isShowingFooter &&
<footer class:list={[{ "bg-stone-900": isShowingPanel }, { "border-t bg-gradient-to-b from-stone-700 to-stone-900 border-amber-900": !isShowingPanel }, "h-[50px] flex justify-between items-center gap-3"]}>
	<div class="h-[32px] mx-3 px-4 py-1 flex items-center bg-lime-100 hover:bg-lime-700 rounded-xl">
		<button class="btn-hackathon sm:hidden text-lime-800 text-base uppercase font-bold hover:text-lime-100">
			#HACKATHON
		</button>
		<button class="btn-hackathon hidden sm:inline text-lime-800 text-base uppercase font-bold hover:text-lime-100">
			#HACKATHON ( WEEK:ONE )
		</button>
	</div>

	<div class="px-3 flex items-center divide-x divide-amber-800">
		<button id="btn-panel" class="h-[32px] px-5 py-1 text-amber-800 text-sm uppercase bg-amber-100 font-bold rounded-xl rounded-r-none hover:bg-amber-700 hover:text-amber-100">
			<svg class="size-6" data-slot="icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
				<path d="M3 10a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM8.5 10a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM15.5 8.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"></path>
			</svg>
		</button>

		<button id="btn-random" class="h-[32px] px-5 py-1 text-amber-800 text-sm uppercase bg-amber-100 font-bold rounded-xl rounded-l-none rounded-r-none hover:bg-amber-700 hover:text-amber-100">
			<svg class="size-6" data-slot="icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
				<path d="M15.98 1.804a1 1 0 0 0-1.96 0l-.24 1.192a1 1 0 0 1-.784.785l-1.192.238a1 1 0 0 0 0 1.962l1.192.238a1 1 0 0 1 .785.785l.238 1.192a1 1 0 0 0 1.962 0l.238-1.192a1 1 0 0 1 .785-.785l1.192-.238a1 1 0 0 0 0-1.962l-1.192-.238a1 1 0 0 1-.785-.785l-.238-1.192ZM6.949 5.684a1 1 0 0 0-1.898 0l-.683 2.051a1 1 0 0 1-.633.633l-2.051.683a1 1 0 0 0 0 1.898l2.051.684a1 1 0 0 1 .633.632l.683 2.051a1 1 0 0 0 1.898 0l.683-2.051a1 1 0 0 1 .633-.633l2.051-.683a1 1 0 0 0 0-1.898l-2.051-.683a1 1 0 0 1-.633-.633L6.95 5.684ZM13.949 13.684a1 1 0 0 0-1.898 0l-.184.551a1 1 0 0 1-.632.633l-.551.183a1 1 0 0 0 0 1.898l.551.183a1 1 0 0 1 .633.633l.183.551a1 1 0 0 0 1.898 0l.184-.551a1 1 0 0 1 .632-.633l.551-.183a1 1 0 0 0 0-1.898l-.551-.184a1 1 0 0 1-.633-.632l-.183-.551Z"></path>
			</svg>
		</button>

		<button id="btn-home" class="h-[32px] px-5 py-1 text-amber-800 text-sm uppercase bg-amber-100 font-bold rounded-xl rounded-l-none hover:bg-amber-700 hover:text-amber-100">
			<svg class="size-6" data-slot="icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
				<path clip-rule="evenodd" fill-rule="evenodd" d="M9.293 2.293a1 1 0 0 1 1.414 0l7 7A1 1 0 0 1 17 11h-1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6H3a1 1 0 0 1-.707-1.707l7-7Z"></path>
			</svg>
		</button>
	</div>
</footer>
}

{isShowingBanner &&
<footer>
	<p>
		BANNER AD GOES HERE
	</p>
</footer>}

<script>
/* Import modules. */
import * as fflate from 'fflate'

const _downloadURL = (data, fileName) => {
	var a
	a = document.createElement('a')
	a.href = data
	a.download = fileName
	document.body.appendChild(a)
	a.click()
	a.remove()
}

const _downloadBlob = (data, fileName, mimeType) => {
	let blob, url
	blob = new Blob([data], {
		type: mimeType
	})
	url = window.URL.createObjectURL(blob);
	_downloadURL(url, fileName);
	setTimeout(() => {
		return window.URL.revokeObjectURL(url)
	}, 1000)
}

// const zipped = fflate.zipSync({
// 	/* Add README. */
// 	'index.html': fflate.strToU8(indexHtml),

// 	/* Add README. */
// 	'js/script.js': fflate.strToU8(javaScript),

// 	/* Add card info. */
// 	'info.json': fflate.strToU8(JSON.stringify(json, null, 2)),

// 	/* Add README. */
// 	'README.TXT': fflate.strToU8(README),
// }, {
// 	// NOTE: Disables compression.
// 	level: 0,
// })
// console.log('ZIPPED', zipped.length, 'bytes')
globalThis.downloadBlob = _downloadBlob
globalThis.fflate = fflate
// _downloadBlob(zipped, `frameify.zip`, 'application/octet-stream')
</script>

<script is:inline>
const PANEL_SLIDE_DURATION = 300

/* Initialize "random" sites. */
// NOTE: Also in `src/pages/index.astro`
const RANDOM_SITES = [
	'https://designmuseum.dk/',
	'https://steffiedeleeuw.com/',
	'https://www.wikipedia.org/',
	'https://www.pichiavo.com/',
	'https://noma.dk/',
	'https://www.landia.com/los-angeles/',
	'https://www.caesarstoneus.com/',
	'https://www.noguchi.org/',
	'https://quebec.ubisoft.com/en/',
	'https://raycharles.cydstumpel.nl/',
	'https://www.artgalleryofballarat.com.au/',
	'https://tetuhi.art/',
	'https://fabbricagroup.fr/',
]

function animate({ timing, draw, duration }) {
    let start = performance.now();

    function step(time) {
        let timeFraction = (time - start) / duration;
        if (timeFraction > 1) timeFraction = 1;

        let progress = timing(timeFraction);

        draw(progress);

        if (timeFraction < 1) {
            requestAnimationFrame(step);
        }
    }

    requestAnimationFrame(step);
}

document.getElementById('btn-home')
	.addEventListener('click', function () {
		/* Initialize Iframe reference. */
		const iFrame = window.document.getElementById('web-stage')

		/* Go to homepage. */
		iFrame.src = 'https://castr.guru'
		// iFrame.src = 'https://castr.guru/hackathon/'
	})

Array.from(document.getElementsByClassName('btn-hackathon'))
	.forEach(_btn => {
		_btn.addEventListener('click', function () {
			/* Initialize Iframe reference. */
			const iFrame = window.document.getElementById('web-stage')

			/* Go to (weekly hackathon) homepage. */
			iFrame.src = 'https://weeklyhackathon.com/'
		})
	})

document.getElementById('btn-random')
	.addEventListener('click', function () {
		/* Initialize locals. */
		let target

		/* Initialize Iframe reference. */
		const iFrame = window.document.getElementById('web-stage')

		/* Select a random target. */
		target = RANDOM_SITES[Math.floor(Math.random() * RANDOM_SITES.length)]

		/* Go to a random target. */
		iFrame.src = target
	})

document.getElementById('btn-download')
	.addEventListener('click', function () {
		/* Set (local) fflate. */
		const fflate = globalThis.fflate

		const indexHtml = `
<h1>Frameify!</h1>
		`

		const javaScript = `
console.log('Welcome to Frameify!')
		`

		const json = {
			hi: 'there!',
		}

		const README = `
FRAMEIFY
--------

( https://frameify.xyz/ )

Let's get started with Frameify.
		`

		/* Initialize zipped. */
		const zipped = fflate.zipSync({
			/* Add README. */
			'index.html': fflate.strToU8(indexHtml),

			/* Add README. */
			'js/script.js': fflate.strToU8(javaScript),

			/* Add card info. */
			'info.json': fflate.strToU8(JSON.stringify(json, null, 2)),

			/* Add README. */
			'README.TXT': fflate.strToU8(README),
		}, {
			// NOTE: Disables compression.
			level: 0,
		})
console.log('ZIPPED', zipped.length, 'bytes')

		/* Download (data) package. */
		globalThis.downloadBlob(zipped, `frameify-2025-01-17-083200.zip`, 'application/octet-stream')
	})

document.getElementById('btn-load-target')
	.addEventListener('click', function () {
		/* Initialize locals. */
		let target

		/* Initialize Iframe reference. */
		const iFrame = window.document.getElementById('web-stage')

		/* Initialize (target) URL (input) reference. */
		const txtTargetUrl = window.document.getElementById('txt-target-url')

		/* Set (target) URL. */
		target = txtTargetUrl.value
console.log('TARGET URL', target)

		/* Set (location) hash. */
		window.location.hash = '#' + target
return
		/* Validate target. */
		if (target.includes('https://')) {
			/* Go to target. */
			iFrame.src = target
		} else {
			/* Go to target. */
			iFrame.src = 'https://' + target
		}
	})

document.getElementById('btn-panel')
	.addEventListener('click', function () {
		/* Initialize frame panel reference. */
		const btnPanel = window.document.getElementById('btn-panel')
		const framePanel = window.document.getElementById('frame-panel')
// console.log('FRAME PANEL', framePanel.style.height)

		/* Validate visibliity. */
		if (framePanel.style.height === '100px') {
			/* Set visibility. */
			// framePanel.style.height='0px'
			animate({
				duration: PANEL_SLIDE_DURATION,
				timing: function(timeFraction) {
					return Math.pow(timeFraction, 2);
				},
				draw: function(progress) {
					framePanel.style.height = `${Math.floor(100 - (progress * 100))}px`
				}
			})

			btnPanel.innerHTML = `
<svg class="size-6" data-slot="icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
	<path d="M3 10a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM8.5 10a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM15.5 8.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"></path>
</svg>
			`
		} else {
			/* Set visibility. */
			// framePanel.style.height='100px'
			animate({
				duration: PANEL_SLIDE_DURATION,
				timing: function(timeFraction) {
					return Math.pow(timeFraction, 2);
				},
				draw: function(progress) {
					framePanel.style.height = `${Math.floor(progress * 100)}px`
				}
			})

			btnPanel.innerHTML = `
<svg class="size-6" data-slot="icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
  	<path d="M10 3a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM10 8.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM11.5 15.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z"></path>
</svg>
			`
		}
	})

window.addEventListener('hashchange', function () {
	/* Initialize locals. */
	let target

	if (location.hash) {
		/* Set target. */
		target = location.hash.slice(1)
	} else {
		// TODO
	}
console.log('HASH VALUE CHANGED -> ' + target)

// FIXME VALIDATE ADDRESS/TARGET

	/* Initialize Iframe reference. */
	const iFrame = window.document.getElementById('web-stage')

	/* Validate target. */
	if (target.includes('https://')) {
		/* Go to target. */
		iFrame.src = target
	} else {
		/* Go to target. */
		iFrame.src = 'https://' + target
	}
})
</script>

<style>
#frame-panel {
	height: 0px;
}
</style>
